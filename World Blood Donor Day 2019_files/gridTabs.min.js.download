"use strict";

(function ($) {
  window.tabsJs = true;
  $('.tabWidget').css({
    display: "block"
  }); // Ignore tabs when only one tab is available in health topic

  function tabRender() {
    var healthTopicTabWidget = $('.health-topic_tabWidget'),
        healthTopicTabWidgetContent = $('.health-topic_tabWidget .single-tabContent');

    if (healthTopicTabWidgetContent.children().length > 1) {
      tabWidget();
    }

    if (healthTopicTabWidget.length > 0 && healthTopicTabWidgetContent.children().length == 1) {
      healthTopicTabWidgetContent.find('.tabHeaderWrapper').hide();
    }

    if (healthTopicTabWidget.length < 1) {
      tabWidget();
    }
  }

  function tabWidget() {
    // check that the page is not in editor view or if it is in Health Topic
    if (!$('body').hasClass('sfPageEditor') || $('.tabWidget').hasClass('health-topic_tabWidget')) {
      //check if there is tabWidget
      $('.tabWidget').each(function () {
        var tabWrapper = $(this),
            tabsCount = 0,
            hash = window.location.hash,
            allUrlTabIds = [],
            publicationUrl = '';
        tabWrapper.addClass('tabWrapper');
        var tabWrapperUL = tabWrapper.find('ul.tabs'); //generate desktop tabs

        tabWrapper.find('.tabHeaderText .sf-content-block').each(function (tabIndex) {
          var tabName = $(this).text().trim();
          tabName = tabName ? tabName : "Tab " + tabIndex; // a tab has no name
          // if (tabName.match(/^[\w& .\-]+$/)) { // a tab has no special characters
          //     var tabId = tabName.toLowerCase().replace(/ /g, '_');
          // } else {

          var tabId = "tab_" + (tabIndex + 1); // start from 1, not 0
          // }

          allUrlTabIds.push(tabId);
          $(this).parents('.singleTabWrapper').attr('data-id', tabId);
          tabWrapperUL.append('<li id="' + tabId + '" class="tabs__item"><span>' + tabName + '</span></li>');
          tabsCount++;
          var hashUrl = '#tab=' + tabId;

          if (hash == '' && tabIndex === 0 && !$('body').hasClass('sfPageEditor')) {
            if (publicationUrl !== "") {
              history.replaceState(undefined, undefined, hashUrl + '&' + publicationUrl);
            } else {
              history.replaceState(undefined, undefined, hashUrl);
            }
          }
        }); //hide default tabs on init

        function isEmpty(el) {
          return !$.trim(el.html());
        }

        tabWrapper.find('.singleTabWrapper ').each(function (k, v) {
          if (isEmpty($(v).find('.tabHeaderText'))) {
            $(v).hide();
          }
        });

        if (tabsCount >= 3) {
          tabWrapperUL.append('<li class="mobile-tab tabs__item" style="width: 50%;"><span>More</span></li>');
        } //desktop tab click function


        $('.tabs__item').on('click', function () {
          if ($(this).hasClass('mobile-tab')) {
            tabWrapperUL.toggleClass('sf-tab-show-hidden');
          } else {
            tabWrapperUL.find('.active').removeClass('active');
            $(this).addClass('active'); // add id to the URL

            var hashUrl = '#tab=' + $(this).attr('id');

            if (!$('body').hasClass('sfPageEditor')) {
              if (publicationUrl !== "") {
                history.replaceState(undefined, undefined, hashUrl + '&' + publicationUrl);
              } else {
                history.replaceState(undefined, undefined, hashUrl);
              }
            } // handle the click


            tabWrapper.find('.singleTabWrapper.visible').removeClass('visible');
            tabWrapper.find('.singleTabWrapper').eq($(this).index()).addClass('visible');
            publicationUrl = "";

            if ($(this).index() !== 0 && $(this).index() !== tabsCount) {
              tabWrapper.find('.mobile-tab').addClass('active');
            } else if ($(this).index() === 0) {
              tabWrapper.find('.mobile-tab').removeClass('active');
            }

            tabWrapperUL.removeClass('sf-tab-show-hidden');
          }
        });

        function adjustTabWidth() {
          tabWrapperUL.removeClass('sf-tab-show-hidden');

          if (tabWrapperUL.width() <= 640) {
            if (tabsCount >= 3) {
              tabWrapperUL.find('li').each(function (i, li) {
                if (i == 0 || i == tabsCount) {
                  // first and `More` are shown
                  $(li).css('width', '50%').addClass('shown').removeClass('hidden');
                } else {
                  $(li).css('width', '100%').addClass('hidden').removeClass('shown');
                }
              });
            } else {
              // tabsCount === 2
              tabWrapperUL.find('li').each(function (i, li) {
                $(li).css('width', '50%').addClass('shown').removeClass('hidden');
              });
            }
          } else {
            tabWrapperUL.find('li').each(function (i, li) {
              $(li).css('width', 100 / tabsCount + '%').addClass('shown').removeClass('hidden');
            });
            $('.mobile-tab').addClass('hidden').removeClass('shown');
          }
        }

        function hashHandler() {
          if (window.location.hash && !$('body').hasClass('sfPageEditor')) {
            var urlTabId = window.location.hash.replace('#tab=', ''); // if publication item is part of the url

            if (window.location.hash.split('&')[1] !== undefined) {
              publicationUrl = window.location.hash.split('&')[1];
              urlTabId = urlTabId.replace('&' + publicationUrl, '');
            }
          } // if Hash is not recognised show first tab


          if (allUrlTabIds.indexOf(urlTabId) === -1) {
            urlTabId = allUrlTabIds[0];
          }

          tabWrapperUL.find('#' + urlTabId).click();
        } //show default tab on mobile and desktop on init


        hashHandler();
        adjustTabWidth();
        $(window).on('resize', adjustTabWidth);
        $(window).on('onhashchange', function (e) {
          if (e.newURL == e.oldURL) {
            return;
          }

          hashHandler();
        });
      });
    }
  }

  tabRender();
})(jQuery);
//# sourceMappingURL=gridTabs.min.js.map
